<?xml version="1.0" encoding="UTF-8"?>
<elasticsearch-dynamic-statement xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" nameSpace="default">
    <select id="ipoCaseSearchByEs" type="dsl" resultType="com.stock.capital.enterprise.ipoCase.dto.IpoCaseIndexDto">
        <![CDATA[
        {
            "track_total_hits" : true,
            "from": ${startRow},
            "size": ${pageSize},
            "query": {
                "bool": {
                    "must": [{
                        "bool": {
                            "must": [
                               {
                                    "match_all": {}
                                }
                                 <#-- 标题关键字 包含全部以空格断开 -->
                                  <#if condition.titleList?? && (condition.titleList?size > 0)>
                                      ,{
                                        "bool": {
                                            "must": [
                                                {
                                                "match_all": { }
                                                }
                                                <#list condition.titleList as item>
                                                ,{
                                                    "match_phrase": {
                                                        "ipo_title_t": {
                                                            "query": "${item}"
                                                        }
                                                    }
                                                }
                                                </#list>
                                            ]
                                        }
                                    }
                                  </#if>
                            ]
                        }
                    }
                      <#-- 公司名称或代码 -->
                     <#if condition.codeOrName??  && condition.codeOrName != ''>
                     ,{
                          "bool": {
                            "should": [
                              {
                                "wildcard": {
                                  "ipo_company_code_s":{
                                    "value": "*${condition.codeOrName}*",
                                    "boost": 1
                                  }
                                }
                              },
                              {
                                "wildcard": {
                                  "ipo_company_name_s": {
                                    "value": "*${condition.codeOrName}*",
                                    "boost": 1
                                  }
                                }
                              },
                              {
                                "wildcard": {
                                  "ipo_company_full_name_s": {
                                    "value": "*${condition.codeOrName}*",
                                    "boost": 1
                                  }
                                }
                              }
                            ]
                          }
                        }
                         </#if>
                      <#-- 所属证监局 -->
                     <#if condition.belongsBureauList??  && (condition.belongsBureauList?size > 0)>
                     ,{
                          "bool": {
                            "should": [
                              <#list condition.belongsBureauList as item>
                                   <#if !item_has_next>
                                          {
                                            "wildcard": {
                                              "ipo_belongs_bureau_t":{
                                                "value": "*${item}*",
                                                "boost": 1
                                              }
                                            }
                                          }
                                    <#else>
                                         {
                                            "wildcard": {
                                              "ipo_belongs_bureau_t":{
                                                "value": "*${item}*",
                                                "boost": 1
                                              }
                                            }
                                          },
                                     </#if>
                             </#list>
                            ]
                          }
                        }
                      </#if>
                       <#-- 注册地 -->
                      <#if condition.registerAreaList??  && (condition.registerAreaList?size > 0)>
                        ,{
                          "bool": {
                            "should": [
                               {
                                        "terms": {
                                            "ipo_addr_country_t": [
                                                <#list condition.registerAreaList as item>
                                                    <#if !item_has_next>
                                                        "${item}"
                                                    <#else>
                                                        "${item}",
                                                    </#if>
                                                </#list>
                                            ],
                                            "boost": 1
                                        }
                                    },
                                    {
                                        "terms": {
                                            "ipo_addr_prov_t": [
                                                <#list condition.registerAreaList as item>
                                                    <#if !item_has_next>
                                                        "${item}"
                                                    <#else>
                                                        "${item}",
                                                    </#if>
                                                </#list>
                                            ],
                                            "boost": 1
                                        }
                                    },
                                    {
                                        "terms": {
                                            "ipo_addr_city_t": [
                                                <#list condition.registerAreaList as item>
                                                    <#if !item_has_next>
                                                        "${item}"
                                                    <#else>
                                                        "${item}",
                                                    </#if>
                                                </#list>
                                            ],
                                            "boost": 1
                                        }
                                    },
                                    {
                                        "terms": {
                                            "ipo_addr_area_t": [
                                                <#list condition.registerAreaList as item>
                                                    <#if !item_has_next>
                                                        "${item}"
                                                    <#else>
                                                        "${item}",
                                                    </#if>
                                                </#list>
                                            ],
                                            "boost": 1
                                        }
                                    }
                              ]
                          }
                        }
                      </#if>
                    ],
                    "must_not": [],
                    "should": [],
                    "filter": [
                        {
                            "bool": {
                                "must": [
                                {
                                "match_all": { }
                                }
                                <#-- 根据CASETYPE查询 ipo库和辅导库 -->
                                <#if condition.caseType??>
                                ,{
                                    "terms": {
                                        "ipo_type_t": [
                                            "${condition.caseType}"
                                        ],
                                        "boost": 1
                                    }
                                }
                                </#if>
                                 <#-- 中介机构 -->
                                <#if condition.intermediaryCode?? && condition.intermediaryCode != ''>
                                ,{
                                    "terms": {
                                        "ipo_intermediary_code_ss": [
                                            "${condition.intermediaryCode}"
                                        ],
                                        "boost": 1
                                    }
                                }
                                </#if>
                                 <#-- 企业性质 -->
                                   <#if condition.companyNatureList?? && (condition.companyNatureList?size > 0)>
                                       ,{
                                        "terms": {
                                            "ipo_company_nature_list_t": [
                                                <#list condition.companyNatureList as item>
                                                    <#if !item_has_next>
                                                        "${item}"
                                                    <#else>
                                                        "${item}",
                                                    </#if>
                                                </#list>
                                            ],
                                            "boost": 1
                                        }
                                    }
                                  </#if>
                                   <#-- 证监会行业 -->
                                   <#if condition.industryCsrcList?? && (condition.industryCsrcList?size > 0)>
                                      ,{
                                        "terms": {
                                            "ipo_industry_csrc_list_t": [
                                                <#list condition.industryCsrcList as item>
                                                    <#if !item_has_next>
                                                        "${item}"
                                                    <#else>
                                                        "${item}",
                                                    </#if>
                                                </#list>
                                            ],
                                            "boost": 1
                                        }
                                    }
                                  </#if>
                                    <#-- ipo次数 -->
                                   <#if condition.ipoNumList?? && (condition.ipoNumList?size > 0)>
                                       ,{
                                        "terms": {
                                            "ipo_declare_num_i": [
                                                <#list condition.ipoNumList as item>
                                                    <#if !item_has_next>
                                                        "${item}"
                                                    <#else>
                                                        "${item}",
                                                    </#if>
                                                </#list>
                                            ],
                                            "boost": 1
                                        }
                                    }
                                  </#if>
                                   <#-- ipo进程 -->
                                   <#if condition.caseStatusList?? && (condition.caseStatusList?size > 0)>
                                       ,{
                                        "terms": {
                                            "ipo_process_t": [
                                                <#list condition.caseStatusList as item>
                                                    <#if !item_has_next>
                                                        "${item}"
                                                    <#else>
                                                        "${item}",
                                                    </#if>
                                                </#list>
                                            ],
                                            "boost": 1
                                        }
                                    }
                                  </#if>
                                   <#-- 审核注册结果 -->
                                   <#if condition.iecResultList?? && (condition.iecResultList?size > 0)>
                                       ,{
                                        "terms": {
                                            "ipo_iec_result_t": [
                                                <#list condition.iecResultList as item>
                                                    <#if !item_has_next>
                                                        "${item}"
                                                    <#else>
                                                        "${item}",
                                                    </#if>
                                                </#list>
                                            ],
                                            "boost": 1
                                        }
                                    }
                                  </#if>
                                   <#-- 上市条件 -->
                                   <#if condition.issueConditionList?? && (condition.issueConditionList?size > 0)>
                                       ,{
                                        "terms": {
                                            "ipo_issue_condition_ss": [
                                                <#list condition.issueConditionList as item>
                                                    <#if !item_has_next>
                                                        "${item}"
                                                    <#else>
                                                        "${item}",
                                                    </#if>
                                                </#list>
                                            ],
                                            "boost": 1
                                        }
                                    }
                                  </#if>
                                   <#-- 配售机制 -->
                                   <#if condition.placingMechanismList?? && (condition.placingMechanismList?size > 0)>
                                       ,{
                                        "terms": {
                                            "ipo_placing_mechanism_t": [
                                                <#list condition.placingMechanismList as item>
                                                    <#if !item_has_next>
                                                        "${item}"
                                                    <#else>
                                                        "${item}",
                                                    </#if>
                                                </#list>
                                            ],
                                            "boost": 1
                                        }
                                    }
                                  </#if>
                                   <#-- 发行后市盈率 -->
                                   <#if condition.peIssueALow?? >
                                       ,{
                                        "range": {
                                            "ipo_pe_issuea_d":{
                                                "gte": ${condition.peIssueALow},
                                                <#if condition.peIssueAHigh??>
                                                "lte": ${condition.peIssueAHigh},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                   <#-- 发行费用 -->
                                   <#if condition.issueFeeLow?? >
                                       ,{
                                        "range": {
                                            "ipo_issue_fee_d":{
                                                "gte": ${condition.issueFeeLow},
                                                <#if condition.issueFeeHigh??>
                                                "lte": ${condition.issueFeeHigh},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                   <#-- 历时 -->
                                   <#if condition.timeDiffLow?? >
                                       ,{
                                        "range": {
                                            "ipo_audit_duration_i":{
                                                "gt": ${condition.timeDiffLow},
                                                <#if condition.timeDiffHigh??>
                                                "lte": ${condition.timeDiffHigh},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                   <#-- 辅导备案时间 -->
                                   <#if condition.fdProcessTimeStart?? && condition.fdProcessTimeEnd??>
                                    ,{
                                        "constant_score": {
                                            "filter": {
                                                "range": {
                                                    "ipo_fd_time_dt": {
                                                        "from": "${condition.fdProcessTimeStart}",
                                                        "to": "${condition.fdProcessTimeEnd}",
                                                        "include_lower": true,
                                                        "include_upper": true,
                                                        "boost": 1
                                                    }
                                                }
                                            },
                                            "boost": 1
                                        }
                                    }
                                </#if>
                                   <#-- 审核时间 -->
                                    <#if condition.fsProcessTimeStart?? && condition.fsProcessTimeEnd??>
                                        ,{
                                            "constant_score": {
                                                "filter": {
                                                    "range": {
                                                        "ipo_final_time_dt": {
                                                            "from": "${condition.fsProcessTimeStart}",
                                                            "to": "${condition.fsProcessTimeEnd}",
                                                            "include_lower": true,
                                                            "include_upper": true,
                                                            "boost": 1
                                                        }
                                                    }
                                                },
                                                "boost": 1
                                            }
                                        }
                                    </#if>
                                   <#-- 受理时间 -->
                                     <#if condition.ypProcessTimeStart?? && condition.ypProcessTimeEnd??>
                                        ,{
                                            "constant_score": {
                                                "filter": {
                                                    "range": {
                                                        "ipo_advance_disclosure_time_dt": {
                                                            "from": "${condition.ypProcessTimeStart}",
                                                            "to": "${condition.ypProcessTimeEnd}",
                                                            "include_lower": true,
                                                            "include_upper": true,
                                                            "boost": 1
                                                        }
                                                    }
                                                },
                                                "boost": 1
                                            }
                                        }
                                    </#if>

                                     <#-- 最近一个年度净利润累计 -->
                                   <#if condition.profitOneStart?? ||  condition.profitOneEnd??>
                                       ,{
                                        "range": {
                                            "ipo_profit_one_d":{
                                                <#if condition.profitOneStart??>
                                                "gte": ${condition.profitOneStart},
                                                </#if>
                                                <#if condition.profitOneEnd??>
                                                "lte": ${condition.profitOneEnd},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                     <#-- 最近一个年度营业收入累计 -->
                                   <#if condition.reveOneStart?? ||  condition.reveOneEnd??>
                                       ,{
                                        "range": {
                                            "ipo_operate_reve_one_d":{
                                                <#if condition.reveOneStart??>
                                                "gte": ${condition.reveOneStart},
                                                </#if>
                                                <#if condition.reveOneEnd??>
                                                "lte": ${condition.reveOneEnd},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                     <#-- 最近一个年度经营活动现金流量净额累计 -->
                                   <#if condition.cashFlowOneStart?? ||  condition.cashFlowOneEnd??>
                                       ,{
                                        "range": {
                                            "ipo_operate_cash_one_d":{
                                                <#if condition.cashFlowOneStart??>
                                                "gte": ${condition.cashFlowOneStart},
                                                </#if>
                                                <#if condition.cashFlowOneEnd??>
                                                "lte": ${condition.cashFlowOneEnd},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                     <#-- 最近二个年度净利润累计 -->
                                   <#if condition.profitTwoStart?? ||  condition.profitTwoEnd??>
                                       ,{
                                        "range": {
                                            "ipo_profit_two_d":{
                                                <#if condition.profitTwoStart??>
                                                "gte": ${condition.profitTwoStart},
                                                </#if>
                                                <#if condition.profitTwoEnd??>
                                                "lte": ${condition.profitTwoEnd},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                     <#-- 最近二个年度营业收入累计 -->
                                    <#if condition.reveTwoStart?? ||  condition.reveTwoEnd??>
                                       ,{
                                        "range": {
                                            "ipo_operate_reve_two_d":{
                                                <#if condition.reveTwoStart??>
                                                "gte": ${condition.reveTwoStart},
                                                </#if>
                                                <#if condition.reveTwoEnd??>
                                                "lte": ${condition.reveTwoEnd},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                     <#-- 最近二个年度净利润累计 -->
                                   <#if condition.cashFlowTwoStart?? ||  condition.cashFlowTwoEnd??>
                                       ,{
                                        "range": {
                                            "ipo_operate_cash_two_d":{
                                                <#if condition.cashFlowTwoStart??>
                                                "gte": ${condition.cashFlowTwoStart},
                                                </#if>
                                                <#if condition.cashFlowTwoEnd??>
                                                "lte": ${condition.cashFlowTwoEnd},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                    <#-- 最近三个年度净利润累计 -->
                                   <#if condition.profitThreeStart?? ||  condition.profitThreeEnd??>
                                       ,{
                                        "range": {
                                            "ipo_profit_three_d":{
                                                <#if condition.profitThreeStart??>
                                                "gte": ${condition.profitThreeStart},
                                                </#if>
                                                <#if condition.profitThreeEnd??>
                                                "lte": ${condition.profitThreeEnd},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                     <#-- 最近三个年度营业收入累计 -->
                                    <#if condition.reveThreeStart?? ||  condition.reveThreeEnd??>
                                       ,{
                                        "range": {
                                            "ipo_operate_reve_three_d":{
                                                <#if condition.reveThreeStart??>
                                                "gte": ${condition.reveThreeStart},
                                                </#if>
                                                <#if condition.reveThreeEnd??>
                                                "lte": ${condition.reveThreeEnd},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                     <#-- 最近三个年度净利润累计 -->
                                   <#if condition.cashFlowThreeStart?? ||  condition.cashFlowThreeEnd??>
                                       ,{
                                        "range": {
                                            "ipo_operate_cash_three_d":{
                                                <#if condition.cashFlowThreeStart??>
                                                "gte": ${condition.cashFlowThreeStart},
                                                </#if>
                                                <#if condition.cashFlowThreeEnd??>
                                                "lte": ${condition.cashFlowThreeEnd},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                     <#-- 总资产 -->
                                   <#if condition.sunAssetStart?? ||  condition.sunAssetEnd??>
                                       ,{
                                        "range": {
                                            "ipo_sum_asset_d":{
                                                <#if condition.sunAssetStart??>
                                                "gte": ${condition.sunAssetStart},
                                                </#if>
                                                <#if condition.sunAssetEnd??>
                                                "lte": ${condition.sunAssetEnd},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                     <#-- 净资产 -->
                                   <#if condition.sumShareQuityStart?? ||  condition.sumShareQuityEnd??>
                                       ,{
                                        "range": {
                                            "ipo_sum_share_quity_d":{
                                                <#if condition.sumShareQuityStart??>
                                                "gte": ${condition.sumShareQuityStart},
                                                </#if>
                                                <#if condition.sumShareQuityEnd??>
                                                "lte": ${condition.sumShareQuityEnd},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                     <#-- 无形资产占净资产的比例 -->
                                   <#if condition.intangibleAssetRatioStart?? ||  condition.intangibleAssetRatioEnd??>
                                       ,{
                                        "range": {
                                            "ipo_intangible_asset_ratio_d":{
                                                <#if condition.intangibleAssetRatioStart??>
                                                "gte": ${condition.intangibleAssetRatioStart},
                                                </#if>
                                                <#if condition.intangibleAssetRatioEnd??>
                                                "lte": ${condition.intangibleAssetRatioEnd},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                     <#-- 发行前股本总额 -->
                                   <#if condition.totalShareIssueBStart?? ||  condition.totalShareIssueBEnd??>
                                       ,{
                                        "range": {
                                            "ipo_total_share_issueb_d":{
                                                <#if condition.totalShareIssueBStart??>
                                                "gte": ${condition.totalShareIssueBStart},
                                                </#if>
                                                <#if condition.totalShareIssueBEnd??>
                                                "lte": ${condition.totalShareIssueBEnd},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                     <#-- 发行后股本总额 -->
                                   <#if condition.totalShareIssueAStart?? ||  condition.totalShareIssueAEnd??>
                                       ,{
                                        "range": {
                                            "ipo_total_share_issuea_d":{
                                                <#if condition.totalShareIssueAStart??>
                                                "gte": ${condition.totalShareIssueAStart},
                                                </#if>
                                                <#if condition.totalShareIssueAEnd??>
                                                "lte": ${condition.totalShareIssueAEnd},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                     <#-- 最近一次估值 -->
                                   <#if condition.valuationValueStart?? ||  condition.valuationValueEnd??>
                                       ,{
                                        "range": {
                                            "ipo_valuation_d":{
                                                <#if condition.valuationValueStart??>
                                                "gte": ${condition.valuationValueStart},
                                                </#if>
                                                <#if condition.valuationValueEnd??>
                                                "lte": ${condition.valuationValueEnd},
                                                </#if>
                                                "boost": 1
                                                }
                                            }
                                        }
                                  </#if>
                                  <#-- 拟上市板块 -->
                                   <#if condition.ipoPlateList?? && (condition.ipoPlateList?size > 0)>
                                       ,{
                                        "terms": {
                                            "ipo_plate_t": [
                                                <#list condition.ipoPlateList as item>
                                                    <#if !item_has_next>
                                                        "${item}"
                                                    <#else>
                                                        "${item}",
                                                    </#if>
                                                </#list>
                                            ],
                                            "boost": 1
                                        }
                                    }
                                  </#if>
                                  <#-- 登录其他资本市场 -->
                                   <#if condition.marketTypeList?? && (condition.marketTypeList?size > 0)>
                                       ,{
                                        "terms": {
                                            "ipo_market_type_ss": [
                                                <#list condition.marketTypeList as item>
                                                    <#if !item_has_next>
                                                        "${item}"
                                                    <#else>
                                                        "${item}",
                                                    </#if>
                                                </#list>
                                            ],
                                            "boost": 1
                                        }
                                    }
                                  </#if>
                                  <#-- 绿色通道 -->
                                   <#if condition.greenPassageList?? && (condition.greenPassageList?size > 0)>
                                       ,{
                                        "terms": {
                                            "ipo_green_passage_t": [
                                                <#list condition.greenPassageList as item>
                                                    <#if !item_has_next>
                                                        "${item}"
                                                    <#else>
                                                        "${item}",
                                                    </#if>
                                                </#list>
                                            ],
                                            "boost": 1
                                        }
                                    }
                                  </#if>
                                  <#-- 公司治理特殊安排 -->
                                   <#if condition.specialArrangeList?? && (condition.specialArrangeList?size > 0)>
                                       ,{
                                        "terms": {
                                            "ipo_special_arrange_ss": [
                                                <#list condition.specialArrangeList as item>
                                                    <#if !item_has_next>
                                                        "${item}"
                                                    <#else>
                                                        "${item}",
                                                    </#if>
                                                </#list>
                                            ],
                                            "boost": 1
                                        }
                                    }
                                  </#if>

                                ]
                            }
                        }
                    ]
                }
            },
            "sort": [
                <#list orderByName?split(",") as orderName>
                <#if !orderName_has_next>
                    {
                        "${orderName}": {
                            "order": "${orderByOrder?split(",")[orderName_index]}"
                        }
                    }
                <#else>
                    {
                        "${orderName}": {
                            "order": "${orderByOrder?split(",")[orderName_index]}"
                        }
                    },
                </#if>
                </#list>
            ],
            "highlight": {
                "pre_tags": [
                    "<font color=\"#FF0000\">"
                ],
                "post_tags": [
                    "</font>"
                ]
            },
            <#-- 分组查询-->
            "aggs": {
                "ipo_plate_t": {
                    "terms": {
                        "field": "ipo_plate_t",
                        "size": 20000
                        }
                },
                 "ipo_market_type_ss": {
                    "terms": {
                        "field": "ipo_market_type_ss" ,
                        "size": 20000
                        }
                },
                 "ipo_green_passage_t": {
                    "terms": {
                        "field": "ipo_green_passage_t" ,
                        "size": 20000
                        }
                },
                 "ipo_special_arrange_ss": {
                    "terms": {
                        "field": "ipo_special_arrange_ss",
                        "size": 20000
                        }
                },
                 "ipo_belongs_bureau_t": {
                    "terms": {
                        "field": "ipo_belongs_bureau_t",
                        "size": 20000
                        }
                }
            }
        }
        ]]>
    </select>

</elasticsearch-dynamic-statement>