<?xml version="1.0" encoding="UTF-8"?>
<elasticsearch-dynamic-statement xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    nameSpace="com.stock.capital.enterprise.ipoCase.dao.LetterQa">
    <select id="letterQaSearch" type="dsl" resultType="com.stock.capital.enterprise.ipoCase.dto.IpoFeedbackIndexDto">
        <![CDATA[
        {   
            "from": ${startRow},
            "size": ${pageSize},
            "track_total_hits" : true,
            "query":{
                "bool": {
                    "should": [ 
                    ],
                    <#-- 过滤器查询 -->
                    "filter": [
                        {
                            "bool": {
                                "must": [
                                {
                                "match_all": { }
                                }
                                <#-- 函件id-->
                                <#if condition.letterId??>
                                ,{
                                    "terms": {
                                        "letter_letter_id_t": [
                                            "${condition.letterId}"        
                                        ]
                                    }
                                }
                                </#if>
                                <#-- 问题类别List-->
                                <#if condition.questionTypeList?? && (condition.questionTypeList?size > 0)>
                                ,{
                                    "terms": {
                                        "letter_question_class_new_id_txt": [
                                            <#list condition.questionTypeList as item>
                                                "${item}"<#if item_has_next>,</#if>
                                            </#list>   
                                        ]
                                    }
                                }
                                </#if>
                                <#-- 问题类别-->
                                <#if condition.questionType??>
                                ,{
                                    "terms": {
                                        "letter_question_class_new_id_txt": [
                                            "${condition.questionType}"        
                                        ]
                                    }
                                }
                                </#if>
                                ]
                            }
                        }
                    ]
                }
            },
            "sort": [
                <#if orderByName?? && orderByName != "">
                <#list orderByName?split(",") as orderName>
                    {
                        "${orderName}": {
                            "order": "${orderByOrder?split(",")[orderName_index]}"
                        }
                    }<#if orderName_has_next>,</#if>
                </#list>
                </#if>
            ]
            <#if condition.groupFlag?? && condition.groupFlag != "">
            <#-- 分组查询-->
            ,"aggs": {
                "letter_question_class_new_id_txt": {
                    "terms": {
                    "field": "letter_question_class_new_id_txt",
                     "size": 5000
                     }
                }
            }
            </#if>
        }
        ]]>
    </select>
    
</elasticsearch-dynamic-statement>